networks:
  default:
    name: gui-tests_default
    ipam:
      config:
        - subnet: 172.30.0.0/16

services:
  gui-tests-runner:
    volumes:
      - ${GUI_REPOSITORY}/tests/e2e_tests/playwright-qemu.config.ts:/e2e/playwright-qemu.config.ts
    environment:
      - CLIENT_IP

  traefik:
    networks:
      default:
        ipv4_address: 172.30.0.100

  client:
    image: registry.mender.io/mendersoftware/mender-qemu-rofs-commercial:mender-master
    # Override configs from base compose file - QEMU client doesn't use Docker configs
    configs: []
    environment:
      - SERVER_URL=https://docker.mender.io
      # This IP is traefik's fixed IP on the Docker network, reachable from QEMU VM via the container's network stack
      - SERVER_IP=172.30.0.100
      - TENANT_TOKEN
    ports:
      - '8822:8822' # Expose QEMU SSH port from container
    hostname: qemu-client
    volumes:
      # Mount patched setup script over the original in the container
      - ${GUI_REPOSITORY}/tests/e2e_tests/qemu/setup-mender-configuration.py:/setup-mender-configuration.py:ro
      - ${SERVER_ROOT}/compose/certs/mender.crt:/mnt/config/server.crt:ro
    networks:
      default:
        aliases:
          - qemu-client
          - client-device
